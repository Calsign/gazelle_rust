load("@rules_rust//rust:defs.bzl", "rust_binary", "rust_library", "rust_test")

# gazelle:exclude test_data
# gazelle:exclude target

rust_library(
    name = "rust_parser_lib",
    srcs = ["src/lib.rs"],
    crate_name = "rust_parser",
    visibility = ["//visibility:private"],
    deps = ["@crates//:syn"],
)

rust_binary(
    name = "rust_parser",
    srcs = ["src/main.rs"],
    visibility = ["//visibility:public"],
    deps = [
        ":rust_parser_lib",
        "//proto:messages_rust_proto",
        "@crates//:clap",
        "@rules_rust_proto__protobuf-2.8.2//:protobuf",
    ],
)

rust_test(
    name = "parse_test",
    srcs = ["tests/parse_test.rs"],
    crate_features = ["bazel"],
    data = glob(["test_data/*.rs"]),
    deps = [
        ":rust_parser_lib",
        "@crates//:lazy_static",
        "@rules_rust//tools/runfiles",
    ],
)
